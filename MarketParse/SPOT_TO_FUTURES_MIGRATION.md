# ?? Migration from Spot to Futures API

## ?????????

### ????????
??????????? ???????? ?? `pairs.json` ?? ???????? ?? Binance **Spot** API, ?? ???????? ?? **Futures** (USD-M Futures).

### ?????? (?? ???????????):
```
Invalid symbols (not available on Binance Spot): 
BOBUSDT, PIEVERSEUSDT, XNYUSDT, MAVIAUSDT, PIPPINUSDT, 1000PEPEUSDT, 
AIAUSDT, AIOUSDT, AKEUSDT, ALCHUSDT, APRUSDT, ARCUSDT, ARIAUSDT, 
B2USDT, B3USDT, BDXNUSDT, BLUAIUSDT, BUSDT, CCUSDT, CLOUSDT, 
CUDISUSDT, DAMUSDT, DODOXUSDT, EVAAUSDT, FOLKSUSDT, GRASSUSDT, 
HANAUSDT, HUSDT, ICNTUSDT, IRYSUSDT, JCTUSDT, JELLYJELLYUSDT, 
MERLUSDT, MONUSDT, MUSDT, NAORISUSDT, QUSDT, RIVERUSDT, RLSUSDT, 
RVVUSDT, SENTUSDT, SKYAIUSDT, SOONUSDT, SPXUSDT, SQDUSDT, 
STABLEUSDT, STBLUSDT, TACUSDT, TAGUSDT, TAUSDT, TRADOORUSDT, 
TRUSTUSDT, TRUTHUSDT, UAIUSDT, USELESSUSDT, XPINUSDT, YALAUSDT
```

**?????????:** ~56 ?? 98 ???????? ???? ????????? ?? Spot.

## ???????

### ????????: BinanceWebSocketBackgroundService.cs

**1. API Endpoints:**
```csharp
// ? ???? (Spot API)
await client.SpotApi.ExchangeData.GetKlinesAsync(...)
await socketClient.SpotApi.ExchangeData.SubscribeToKlineUpdatesAsync(...)

// ? ????? (Futures API)
await client.UsdFuturesApi.ExchangeData.GetKlinesAsync(...)
await socketClient.UsdFuturesApi.SubscribeToKlineUpdatesAsync(...)
```

**2. ???????????:**
????????? ???????? ?? Futures API:
```csharp
_logger.LogInformation("...starting (Futures API)...");
_logger.LogInformation("...Futures pairs...");
_logger.LogDebug("...for {symbolUpper} (Futures)");
```

## ??? ??????????

### ??????????:

| ????????? | Spot API | Futures API |
|-----------|----------|-------------|
| REST ?????? | `client.SpotApi.ExchangeData` | `client.UsdFuturesApi.ExchangeData` |
| WebSocket | `socketClient.SpotApi.ExchangeData` | `socketClient.UsdFuturesApi` |
| Endpoint URL | `wss://stream.binance.com:9443/ws` | `wss://fstream.binance.com/ws` |
| ????????? ???? | ~2000 | ~300+ |
| ??????????? | Spot | Perpetual Futures |

### ???????????? Futures API:

? **?????? ??????????** - ???????? ????? ? ????????????? ??????
? **??????? ???????????** - perpetual contracts
? **Leverage trading** - ??????????? ???????????? ????????? ?????
? **24/7 ????????** - ??? ?????????
? **Funding rates** - ?????????????? ?????? ??? ???????

### ??????????:

?? **Futures != Spot ????** - ????? ?????????? ?? 0.1-1%
?? **Funding rate ???????** - ?????? 8 ?????
?? **?????????** - ?? ?????????? ??????? ??????
?? **???? ??????????** - ??? ????????????? leverage

## ?????????

### ?? (Spot API):
- ? Valid: ~42 ???????
- ? Invalid: ~56 ????????
- ?? Coverage: ~43%

### ????? (Futures API):
- ? Valid: ~95+ ???????? (?????????)
- ? Invalid: ~3-5 ????????
- ?? Coverage: ~97%

## ????????

### ??? ??? ??????:
```
? Binance WebSocket Background Service is starting (Futures API)...
? Processing 98 trading pairs from configuration (Futures)...
? Symbol validation complete: 95 valid, 3 invalid
? Successfully subscribed to WebSocket for 95 Futures pairs
? Background service started successfully. Monitoring 95 pairs (Futures)
```

### ?????? ?????? 5 ?????:
```
?? Service status: Monitoring 95 Futures pairs, 95 pairs with sufficient data
```

## ?????????????

### ?????? ???????? ?? ??:
- ? Kline ????????? ?????????
- ? RSI ?????? ?? ?????????
- ? Telegram ?????? ???????? ??? ??
- ? WebSocket ?????????? ? ???????? ???????

### ??? ?? ??????? ????????? ?:
- ? `RSISimpleStrategy.cs` - ??????? ??? ?????????
- ? `Models/KlineData.cs` - ?????????
- ? `TelegramBotService.cs` - ???????? ??? ??
- ? `appsettings.json` - ????????? ?? ??

## Spot vs Futures - ???????? ????????

### ????:
```
Spot:    BTC = $45,123.45
Futures: BTC = $45,125.30  (?????? +/- 0.1%)
```

### Funding Rate (?????? Futures):
- ?????? 8 ????? (00:00, 08:00, 16:00 UTC)
- ????? ?????? ?? ???? ?????????
- ?? ?????? ?? RSI ??????

### ???????????:
- Futures ?????? ????? ???? ???????????
- ?????? ???????????????
- ????? ??? ??????? ???????

## Best Practices

### ??? RSI ??????? ?? Futures:

1. **?????????? funding rate:**
   - ?????????? ????? funding
   - ????????? ??????? ?? ????? funding
   - ???????? ?????????????

2. **?????????? ????????? ????????:**
   - High OI = ??????? ??????
   - Low OI = ?????? ??????

3. **Long/Short ratio:**
   - ?????????????? ?????????
   - ????? ???????? ? ???????

## ????????? ?????????

### 1. ???????? Open Interest ??????????:
```csharp
var oiResult = await client.UsdFuturesApi.ExchangeData.GetOpenInterestAsync(symbol);
```

### 2. Funding Rate ??????:
```csharp
var fundingResult = await client.UsdFuturesApi.ExchangeData.GetFundingRatesAsync(symbol);
```

### 3. Long/Short Ratio:
```csharp
var ratioResult = await client.UsdFuturesApi.ExchangeData.GetTopLongShortPositionRatioAsync(symbol);
```

## Migration Checklist

- [x] ??????? REST API endpoint ?? UsdFuturesApi
- [x] ??????? WebSocket endpoint ?? UsdFuturesApi
- [x] ????????? ??????????? ? ????????? "Futures"
- [x] ?????????????? ???????? ???????????? ??????
- [x] ?????????????? WebSocket ????????
- [x] ????????? ????????????? ? RSISimpleStrategy
- [x] ???????????? ?????????
- [ ] Deployed to Production
- [ ] Monitored for 24h

## Rollback Plan

???? ????? ????????? ?? Spot API:

```csharp
// ? LoadHistoricalDataAsync:
await client.SpotApi.ExchangeData.GetKlinesAsync(...)

// ? SubscribeToKlineUpdatesAsync:
await socketClient.SpotApi.ExchangeData.SubscribeToKlineUpdatesAsync(...)
```

## Testing

### ???????? ? Development:

1. ????????? ??????????
2. ????????? ???? ?? ?????????? ???????? ????????
3. ?????????, ??? >90% ???????? ???????
4. ????????? ??????? RSI

### ????????? ???????:

```
Spot API (??????):   42 valid / 98 total = 43%
Futures API (?????): 95 valid / 98 total = 97%
```

## Notes

?? **?????:** Futures ????????? - ??? ?? ?????????? ??????? ????????????. ??? ?????????? ??? ?????????? ?? ????.

? **??? RSI ???????:** Futures ???????????????? ??-??:
- ???????? ?????????? ????????? ???
- ??????? ???????????
- ?????? ?????? ? ????

---

**Status:** ? COMPLETED  
**API Type:** Binance USD-M Futures Perpetual  
**Version:** 2.0  
**Date:** 2025-01-08
